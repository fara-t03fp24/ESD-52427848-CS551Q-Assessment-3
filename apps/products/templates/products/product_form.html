{% extends 'base.html' %}
{% load static %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Create{% endif %} Product - 3D Printing Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'products/css/product_form.css' %}">
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h2 class="card-title mb-4">{% if form.instance.pk %}Edit{% else %}Create{% endif %} Product</h2>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                        <div class="alert alert-danger">
                            Please correct the errors below.
                        </div>
                    {% endif %}

                    <div class="mb-3">
                        <label class="form-label">Product Images</label>
                        <div class="image-upload-container">
                            {% if product.images.exists %}
                                <div class="image-grid mb-3">
                                    {% for image in product.images.all %}
                                        <div class="image-preview-wrapper">
                                            <img src="{{ image.image.url }}" alt="Product image" class="image-preview">
                                            <div class="image-actions">
                                                <input type="checkbox" name="remove_images" value="{{ image.id }}" id="remove_{{ image.id }}">
                                                <label for="remove_{{ image.id }}" class="remove-label">Remove</label>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <input type="file" class="form-control" name="product_images" multiple accept="image/*">
                            <small class="form-text text-muted">Upload one or more product images. The first image will be used as the primary image.</small>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.name.id_for_label }}" class="form-label">Product Name</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.name.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.category.id_for_label }}" class="form-label">Category</label>
                        {{ form.category }}
                        {% if form.category.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.category.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.description.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.price.id_for_label }}" class="form-label">Price ($)</label>
                            {{ form.price }}
                            {% if form.price.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.price.errors }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.stock.id_for_label }}" class="form-label">Stock</label>
                            {{ form.stock }}
                            {% if form.stock.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.stock.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.print_time_hours.id_for_label }}" class="form-label">Print Time (hours)</label>
                            {{ form.print_time_hours }}
                            {% if form.print_time_hours.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.print_time_hours.errors }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.material_type.id_for_label }}" class="form-label">Material Type</label>
                            {{ form.material_type }}
                            {% if form.material_type.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.material_type.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.difficulty_level.id_for_label }}" class="form-label">Difficulty Level</label>
                            {{ form.difficulty_level }}
                            {% if form.difficulty_level.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.difficulty_level.errors }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.weight_grams.id_for_label }}" class="form-label">Weight (grams)</label>
                            {{ form.weight_grams }}
                            {% if form.weight_grams.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.weight_grams.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.dimensions.id_for_label }}" class="form-label">Dimensions (length x width x height in mm)</label>
                        {{ form.dimensions }}
                        {% if form.dimensions.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.dimensions.errors }}
                            </div>
                        {% endif %}
                    </div>

                    {% if form.instance.pk %}
                        <div class="mb-3">
                            <label for="{{ form.is_active.id_for_label }}" class="form-label">Product Status</label>
                            <div class="form-check">
                                {{ form.is_active }}
                                <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                    Active (uncheck to hide from store)
                                </label>
                            </div>
                            {% if form.is_active.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.is_active.errors }}
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">
                            {% if form.instance.pk %}Save Changes{% else %}Create Product{% endif %}
                        </button>
                        <a href="{% url 'products:product_list' %}" class="btn btn-outline-secondary ms-2">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% endblock %}