{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Physical 3D Print | PrintCraft{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'products/css/product_detail.css' %}">
<link href="{% static 'products/css/shop.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'products:product_list' %}">Physical Models</a></li>
            <li class="breadcrumb-item active">{{ product.name }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-6">
            <div class="product-image-gallery">
                <img src="{{ product.image.url }}" class="img-fluid rounded shadow" alt="{{ product.name }}">
                {% if product.additional_images.all %}
                <div class="row mt-3">
                    {% for img in product.additional_images.all %}
                    <div class="col-3">
                        <img src="{{ img.image.url }}" class="img-thumbnail" alt="Additional view of {{ product.name }}">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="col-md-6">
            <h1 class="mb-3">{{ product.name }}</h1>
            <div class="mb-3">
                <span class="badge bg-success">Ready to Ship</span>
                <span class="badge bg-info">Handcrafted</span>
                {% if product.in_stock %}
                    <span class="badge bg-primary">In Stock</span>
                {% endif %}
            </div>
            
            <div class="mb-4">
                <h2 class="fs-2">${{ product.price }}</h2>
                <p class="text-muted">Shipping calculated at checkout</p>
            </div>

            <div class="mb-4">
                <h3 class="fs-5 mb-3">Product Details</h3>
                <p>{{ product.description }}</p>
                <ul class="list-unstyled">
                    <li><i class="fas fa-ruler me-2"></i>Dimensions: {{ product.dimensions }}</li>
                    <li><i class="fas fa-palette me-2"></i>Material: {{ product.material }}</li>
                    <li><i class="fas fa-clock me-2"></i>Print Time: {{ product.print_time }}</li>
                    <li><i class="fas fa-weight me-2"></i>Weight: {{ product.weight }}</li>
                </ul>
            </div>

            <div class="mb-4">
                <h3 class="fs-5 mb-3">Maker Information</h3>
                <div class="d-flex align-items-center">
                    {% if product.shop.logo %}
                        <img src="{{ product.shop.logo.url }}" class="rounded-circle me-2" style="width: 50px; height: 50px;" alt="{{ product.shop.name }}">
                    {% endif %}
                    <div>
                        <h4 class="fs-6 mb-1">{{ product.shop.name }}</h4>
                        <p class="text-muted mb-0">{{ product.shop.description|truncatewords:20 }}</p>
                    </div>
                </div>
            </div>

            <form method="post" action="{% url 'orders:add_to_cart' product.id %}" class="mb-4">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="quantity" name="quantity" value="1" min="1" max="{{ product.stock }}">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                        </button>
                    </div>
                </div>
            </form>

            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Quality Guarantee:</strong> Each model is carefully printed, finished, and quality-checked before shipping.
            </div>
        </div>
    </div>

    {% if related_products %}
    <div class="related-products mt-5">
        <h3 class="mb-4">Similar Physical Models</h3>
        <div class="row g-4">
            {% for related in related_products %}
            <div class="col-md-3">
                <div class="card h-100">
                    <img src="{{ related.image.url }}" class="card-img-top" alt="{{ related.name }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ related.name }}</h5>
                        <p class="card-text">${{ related.price }}</p>
                        <a href="{% url 'products:product_detail' related.id %}" class="btn btn-outline-primary">View Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}